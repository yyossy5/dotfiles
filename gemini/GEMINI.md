# GEMINI.md - Gemini CLI グローバル設定

## 全般

- 常に日本語で会話すること
- 横に長過ぎるコメントやMarkdown文書は避ける。大体1行英数字換算で88文字くらいを目安とする
- Markdownで見出しと本文の間は常に1行改行を入れること
- 日本語の文章を出力する際は基本的には「ですます調」ではなく、本文書のような常体とする
- プロジェクトで採用しているツールが既にあるのであれば、ここで使用を推薦しているツールより優先すること
- 最大限の効率を追求するために、複数の独立した処理を実行しなければならない場合は、
  それらのツールを順番に呼び出すのではなく、同時に起動する。
- 仕様に疑問があれば必ず立ち止まってユーザに質問すること
- コード変更の前にまずは計画を立ててユーザのレビューを受けること

## 開発哲学

言語に依らない開発全般について従うべき方針を記載する。

### 開発の進め方

#### Test-Driven Development (TDD)

- ソフトウェア開発では原則としてテスト駆動開発（TDD）で進める
- 期待される入出力に基づき、まずテストを作成する
- 実装コードは書かず、テストのみを用意する
- テストを実行し、失敗を確認する
- テストが正しいことを確認できた段階でコミットする
- その後、テストをパスさせる実装を進める
- 実装中はテストを変更せず、コードを修正し続ける
- すべてのテストが通過するまで繰り返す

### テストについての考え方

テストについての基本的な考え方を以下に記載する。

- 良いテストとは、以下を備えるもの
  - 退行（regression）に対する保護
  - リファクタリングへの耐性
  - 迅速なフィードバック
  - 保守のしやすさ
- テストで検証するのは、外部から観察可能な振る舞いのみとする
- 価値をもたらさないテストケースは追加しない
- Mockは、システム境界（外部依存(DBや外部API)やそのためのアダプタ）、時間設定等に対し
  適用可能とし、それ以外には基本的に使用しない

## コードドキュメンテーション

### プロダクションコード

- 新規クラスや新規関数には必ずドキュメント(pythonならdocstring, JavaならJavaDoc等)を完備する。

### テストコード

- テストケースを表す新規メソッドには、何を検証するかを簡潔に記述したドキュメントを付ける。

## Python開発

### ドキュメント

- docstringはGoogleスタイルにする

## Java開発

### Test

#### テストフレームワーク

- JUnit5

#### テスト作成方針

- ケースが多い場合などはParameterized Testを使用する

#### テスト実行して検証する場合

以下のように最小限のテストケースを実行するようにする。

```bash
# sut-mvn-moduleモジュールのXXXTestクラスのyyyTestMethodメソッドを実行する
mvn test -pl sut-mvn-module -Dtest=XXXTest#yyyTestMethod
```

## Markdown

- 見づらくなるため横に長過ぎる1文はNG。厳守でなくても良いが、大体1行英数字で88文字あたりとする。

## 🚫 セキュリティと品質標準

### 禁止ルール（交渉不可）

- **禁止：明示的な確認なしに本番データを削除**
- **禁止：APIキー、パスワード、シークレットのハードコード**
- **禁止：テストやリンティングエラーを伴うコードのコミット**
- **禁止：main/masterブランチへの直接プッシュ**
- **禁止：認証/認可コードのセキュリティレビューのスキップ**

### 必須ルール（必要な標準）

- **必須：新機能とバグ修正にテストを記述**
- **必須：タスク完了前にCI/CDチェックを実行**
- **必須：リリースでセマンティックバージョニングに従う**
- **必須：破壊的変更を文書化**
- **必須：すべての開発でフィーチャーブランチを使用**
- **必須：すべてのパブリックAPIに包括的なドキュメントを追加**

## 🔧 コミット標準

### Conventional Commits

```bash
# フォーマット: <type>(<scope>): <subject>
git commit -m "feat(auth): add JWT token refresh"
git commit -m "fix(api): handle null response correctly"
git commit -m "docs(readme): update installation steps"
git commit -m "perf(db): optimize query performance"
git commit -m "refactor(core): extract validation logic"
```

### コミットその他

以下のような使用ツールに関する文言はコミットメッセージには不要。

```bash
🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

## コードレビュー方法

コードレビュー指示を出された場合に、GitHubやBitbucketのPR内容を参照出来ない場合は、
ローカルにレビュー対象ブランチをcheckoutし、
mainやdevelopなど指定されたブランチとの差分をローカルでレビューするようにする。
また、特別な指示が無ければコミット済みの内容のみレビュー対象とすれば良い
（ローカルにあるコミットしていない差分やUntrackingな差分はレビュー不要）。

コードレビュー観点は、レビュー対象リポジトリルートのGEMINI.mdに記載があるので
そちらの観点を中心にレビューする。

また、仕様が提示されていない場合は、提示できるかなどをレビューに入る前にユーザに確認する。

## ドキュメントレビュー

ドキュメントレビュー指示を出された場合は、以下の観点と確認項目を参考にレビューする。
（ドキュメントの内容に応じて必要な観点は変わるので、取捨選択する。）

レビュー結果の出力形式

- 総評を記載
- 観点と確認項目ごとに、指摘内容を分かりやすく記載（現状と修正提案）
- ⭐️が付いている確認項目は出力でも⭐️を付ける
- 気付いたことは省略せず指摘内容として記載

⭐️：重要度高

### 1. レビュー依頼 (レビューを円滑に進めるために)

レビューを依頼する際に、レビュアーに明確に伝えるべき事項。
これにより、レビューの質と時間効率が向上する。

- **ドキュメントの目的と背景を伝える**
  - このドキュメントが「何を解決したいのか」「どのような背景で作成されたのか」を明確に記載する。
- **レビューのゴールを示す**
  - レビュアーに何を期待するのかを伝える。
  - 「〜を承認してほしい」「〜について意見がほしい」「アイデアの壁打ち相手になってほしい」など、具体的なゴールを示す。
- **重点的に見てほしい箇所があれば伝える**
  - 特に自信がない部分や、議論したい論点を具体的に示すことで、レビュアーがどこに注目すべきか分かりやすくなる。

### 2. 構成と論理展開 (分かりやすいストーリーか)

ドキュメント全体の構造や話の流れに関する観点。
読み手がストレスなく内容を理解できるかをチェックする。

- **全体像の提示**
  - 冒頭に、全体の要約（サマリー）や結論を記載する。
  - ⭐️「これはシステム全体のどの部分の話か」など、議論対象のものが全体のどこにあたるのかを明確にする。
- **論理的な構成**
  - 話の流れは論理的か（例: PREP法、背景 → 課題 → 提案 → 詳細 → 結論）。
  - ⭐️論理を展開するにあたり、まず現状を整理しているか
  - 各セクションの見出しは、内容を的確に表現しているか。
  - セクション間のつながりは自然か（唐突に新しい話題が出てきていないか）。
- **情報の順序と粒度**
  - 前提となる知識や決定事項が、後から出てきていないか。
  - 読み手にとって未知の情報を、説明なしで使っていないか。
  - 本質的でない詳細は、本文から切り離しているか（例: Appendixにまとめる）。

### 3. 内容の明確性と説得力 (主張と根拠は確かか)

ドキュメントで伝えたい内容そのものの質に関する観点。
主張に説得力があり、誤解なく伝わるかをチェックする。

- **主張と結論**
  - ⭐️データや複数の案を並べるだけでなく、自らの主張や提案が明確に書かれているか（レビュアーに判断を丸投げしていないか）。
  - ⭐️結論は、調査結果や考察と論理的に繋がっているか。
  - ⭐️期待値は何か、それに対して実績値はどうだったか、のように説明しているか。
    - 期待値が無いと、結果だけ見ても解釈しづらい
  - （あれば）今後の課題や、次のアクションについても言及されているか。
- **事実と意見の分離**
  - 客観的な「事実（データ、事象）」と、書き手の「意見（考察、推測）」が区別して書かれているか。
- **データと分析**
  - データの出所（取得方法）は説明されているか。
    - 直感に反するようなデータである場合などに、レビュアーはそのデータを具体的にどのように得たかを知りたくなることがある
    - 使用したクエリなど
  - 収集した情報に対する分析や比較は十分か。
  - ⭐️全体のなかでそのデータはどんな割合なのか。
    - 例えば、好ましくないデータがあったとしても、割合が極小ならば無視するという選択肢も考えられる
- **表現の明確さ**
  - 主張内容は一意に解釈できるように書かれているか（曖昧な表現はないか）。

### 4. 表現の一貫性と分かりやすさ (読みやすいか)

文章、図、表などの表現方法に関する観点。
認知負荷が低く直感的に理解できるかをチェックする。

- **用語と表現**
  - 読み手のコンテキストを意識しているか。
    - 伝わらない専門用語を多用したり、伝わらないコードの細かい話をしたりしていないか
  - 「ユーザー」と「利用者」など、同じ意味の言葉が複数の表現で書かれていないか（表記揺れの防止）。
  - ⭐️特に新しい概念について、命名は適切であるか。定義は明確に示されているか。
- **図・表・グラフ・数値**
  - 複雑な内容は、文章だけでなく図や表を使って分かりやすく表現されているか。
  - ⭐️図/表/グラフが何を伝えたいものなのか分かるようになっているか
    - タイトル、縦軸や横軸の説明、凡例、補足説明などが付いているか
    - 情報過多になっていないか
  - グラフの軸やスケールは、ミスリードを誘うものになっていないか。
  - ⭐️数値を並べる際は、桁数やカンマを揃える、右揃えに統一するなど、比較しやすくなる工夫がされているか。

### 5. セルフレビュー (基本的な品質)

ドキュメントを提出する前に、作成者自身が確認すべき最低限のチェック項目。

- 誤字脱字や、不自然な言い回しはないか。
- 表記揺れはないか。
- 自分で読み返し、論理展開に違和感がないか。
- 第三者や未来の自分が読んでも理解できそうか。
- 指摘内容を修正したことで、整合性が取れなくなっている記述が無いか。
